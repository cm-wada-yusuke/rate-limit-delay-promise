"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
const delay = require("delay");
class RateLimitPromise {
    static all(values, asyncExecutor, delayMillis) {
        const delayedValues = RateLimitPromise.delayedValuesGenerator(values, delayMillis);
        return RateLimitPromise.delayedValuesExecution(delayedValues, asyncExecutor);
    }
    static delayedValuesExecution(delayedValues, asyncExecutor) {
        return delayedValues.reduce((prev, curr) => {
            return prev.then(async (array) => {
                const value = await curr();
                const result = await asyncExecutor(value);
                return array.concat(result);
            });
        }, Promise.resolve([]));
    }
    static delayedValuesGenerator(values, delay) {
        return values.map(v => RateLimitPromise.delayedValue(v, delay));
    }
    static delayedValue(value, interval) {
        return async () => {
            await delay(interval);
            return value;
        };
    }
}
exports.RateLimitPromise = RateLimitPromise;
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiaW5kZXguanMiLCJzb3VyY2VSb290IjoiIiwic291cmNlcyI6WyJpbmRleC50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiOztBQUFBLCtCQUErQjtBQUUvQixNQUFhLGdCQUFnQjtJQUV6QixNQUFNLENBQUMsR0FBRyxDQUFPLE1BQVcsRUFBRSxhQUF5QyxFQUFFLFdBQW1CO1FBQ3hGLE1BQU0sYUFBYSxHQUFHLGdCQUFnQixDQUFDLHNCQUFzQixDQUFDLE1BQU0sRUFBRSxXQUFXLENBQUMsQ0FBQztRQUNuRixPQUFPLGdCQUFnQixDQUFDLHNCQUFzQixDQUFDLGFBQWEsRUFBRSxhQUFhLENBQUMsQ0FBQztJQUNqRixDQUFDO0lBRU8sTUFBTSxDQUFDLHNCQUFzQixDQUFPLGFBQW1DLEVBQUUsYUFBeUM7UUFDdEgsT0FBTyxhQUFhLENBQUMsTUFBTSxDQUFDLENBQUMsSUFBa0IsRUFBRSxJQUF3QixFQUFFLEVBQUU7WUFDekUsT0FBTyxJQUFJLENBQUMsSUFBSSxDQUFDLEtBQUssRUFBQyxLQUFLLEVBQUMsRUFBRTtnQkFDM0IsTUFBTSxLQUFLLEdBQU0sTUFBTSxJQUFJLEVBQUUsQ0FBQztnQkFDOUIsTUFBTSxNQUFNLEdBQUcsTUFBTSxhQUFhLENBQUMsS0FBSyxDQUFDLENBQUM7Z0JBQzFDLE9BQU8sS0FBSyxDQUFDLE1BQU0sQ0FBQyxNQUFNLENBQUMsQ0FBQztZQUNoQyxDQUFDLENBQUMsQ0FBQTtRQUNOLENBQUMsRUFBRSxPQUFPLENBQUMsT0FBTyxDQUFDLEVBQUUsQ0FBQyxDQUFDLENBQUM7SUFDNUIsQ0FBQztJQUVPLE1BQU0sQ0FBQyxzQkFBc0IsQ0FBSSxNQUFXLEVBQUUsS0FBYTtRQUMvRCxPQUFPLE1BQU0sQ0FBQyxHQUFHLENBQUMsQ0FBQyxDQUFDLEVBQUUsQ0FBQyxnQkFBZ0IsQ0FBQyxZQUFZLENBQUMsQ0FBQyxFQUFFLEtBQUssQ0FBQyxDQUFDLENBQUM7SUFDcEUsQ0FBQztJQUVPLE1BQU0sQ0FBQyxZQUFZLENBQUksS0FBUSxFQUFFLFFBQWdCO1FBQ3JELE9BQU8sS0FBSyxJQUFJLEVBQUU7WUFDZCxNQUFNLEtBQUssQ0FBQyxRQUFRLENBQUMsQ0FBQztZQUN0QixPQUFPLEtBQUssQ0FBQztRQUNqQixDQUFDLENBQUE7SUFDTCxDQUFDO0NBRUo7QUE1QkQsNENBNEJDIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0ICogYXMgZGVsYXkgZnJvbSAnZGVsYXknO1xuXG5leHBvcnQgY2xhc3MgUmF0ZUxpbWl0UHJvbWlzZSB7XG5cbiAgICBzdGF0aWMgYWxsPFQsIFU+KHZhbHVlczogVFtdLCBhc3luY0V4ZWN1dG9yOiAoKHZhbHVlOiBUKSA9PiBQcm9taXNlPFU+KSwgZGVsYXlNaWxsaXM6IG51bWJlcik6IFByb21pc2U8VVtdPiB7XG4gICAgICAgIGNvbnN0IGRlbGF5ZWRWYWx1ZXMgPSBSYXRlTGltaXRQcm9taXNlLmRlbGF5ZWRWYWx1ZXNHZW5lcmF0b3IodmFsdWVzLCBkZWxheU1pbGxpcyk7XG4gICAgICAgIHJldHVybiBSYXRlTGltaXRQcm9taXNlLmRlbGF5ZWRWYWx1ZXNFeGVjdXRpb24oZGVsYXllZFZhbHVlcywgYXN5bmNFeGVjdXRvcik7XG4gICAgfVxuXG4gICAgcHJpdmF0ZSBzdGF0aWMgZGVsYXllZFZhbHVlc0V4ZWN1dGlvbjxULCBVPihkZWxheWVkVmFsdWVzOiAoKCkgPT4gUHJvbWlzZTxUPilbXSwgYXN5bmNFeGVjdXRvcjogKCh2YWx1ZTogVCkgPT4gUHJvbWlzZTxVPikpOiBQcm9taXNlPFVbXT4ge1xuICAgICAgICByZXR1cm4gZGVsYXllZFZhbHVlcy5yZWR1Y2UoKHByZXY6IFByb21pc2U8VVtdPiwgY3VycjogKCgpID0+IFByb21pc2U8VD4pKSA9PiB7XG4gICAgICAgICAgICByZXR1cm4gcHJldi50aGVuKGFzeW5jIGFycmF5ID0+IHtcbiAgICAgICAgICAgICAgICBjb25zdCB2YWx1ZTogVCA9IGF3YWl0IGN1cnIoKTtcbiAgICAgICAgICAgICAgICBjb25zdCByZXN1bHQgPSBhd2FpdCBhc3luY0V4ZWN1dG9yKHZhbHVlKTtcbiAgICAgICAgICAgICAgICByZXR1cm4gYXJyYXkuY29uY2F0KHJlc3VsdCk7XG4gICAgICAgICAgICB9KVxuICAgICAgICB9LCBQcm9taXNlLnJlc29sdmUoW10pKTtcbiAgICB9XG5cbiAgICBwcml2YXRlIHN0YXRpYyBkZWxheWVkVmFsdWVzR2VuZXJhdG9yPFQ+KHZhbHVlczogVFtdLCBkZWxheTogbnVtYmVyKTogKCgpID0+IFByb21pc2U8VD4pW10ge1xuICAgICAgICByZXR1cm4gdmFsdWVzLm1hcCh2ID0+IFJhdGVMaW1pdFByb21pc2UuZGVsYXllZFZhbHVlKHYsIGRlbGF5KSk7XG4gICAgfVxuXG4gICAgcHJpdmF0ZSBzdGF0aWMgZGVsYXllZFZhbHVlPFQ+KHZhbHVlOiBULCBpbnRlcnZhbDogbnVtYmVyKTogKCkgPT4gUHJvbWlzZTxUPiB7XG4gICAgICAgIHJldHVybiBhc3luYyAoKSA9PiB7XG4gICAgICAgICAgICBhd2FpdCBkZWxheShpbnRlcnZhbCk7XG4gICAgICAgICAgICByZXR1cm4gdmFsdWU7XG4gICAgICAgIH1cbiAgICB9XG5cbn1cblxuXG4iXX0=